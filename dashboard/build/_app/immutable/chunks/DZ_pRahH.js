import{X as r}from"./Bc9KpfpO.js";const i="/api";class u{token=null;constructor(){typeof window<"u"&&(this.token=localStorage.getItem("dashboard_token"))}setToken(t){this.token=t,typeof window<"u"&&localStorage.setItem("dashboard_token",t)}clearToken(){this.token=null,typeof window<"u"&&localStorage.removeItem("dashboard_token")}getToken(){return this.token}async request(t,s={}){const n={"Content-Type":"application/json",...s.headers};this.token&&(n.Authorization=`Bearer ${this.token}`);const e=await fetch(`${i}${t}`,{...s,headers:n});if(!e.ok)throw e.status===401?(this.clearToken(),new Error("Unauthorized")):new Error(`API error: ${e.status} ${e.statusText}`);return e.json()}async getAuthStatus(){return this.request("/auth/me")}}const o=new u;function c(){const{subscribe:a,set:t,update:s}=r({isAuthenticated:!1,userId:null,isLoading:!0});return{subscribe:a,async checkAuth(){if(s(e=>({...e,isLoading:!0})),!o.getToken())return t({isAuthenticated:!1,userId:null,isLoading:!1}),!1;try{const e=await o.getAuthStatus();return t({isAuthenticated:e.is_authenticated,userId:e.user_id,isLoading:!1}),e.is_authenticated}catch{return t({isAuthenticated:!1,userId:null,isLoading:!1}),!1}},login(n){o.setToken(n),this.checkAuth()},logout(){o.clearToken(),t({isAuthenticated:!1,userId:null,isLoading:!1})}}}const l=c();export{l as a};
